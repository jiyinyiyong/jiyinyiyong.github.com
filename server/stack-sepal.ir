{:definitions {"tiye-server.schema/database" ["def" "database" ["{}" [":states" ["{}"]] [":users" ["{}"]] [":messages" ["{}"]]]], "tiye-server.main/-main" ["defn" "-main" [] ["nodejs/enable-util-print!"] ["setup-server!" "db-ref" "updater" "render-scene" "render-view" ["{}" ":port" "5020"]] ["add-watch" "db-ref" ":log" ["fn" []]] ["println" "|server started"]], "tiye-server.updater.core/updater" ["defn" "updater" ["db" "op" "op-data" "state-id" "op-id" "op-time"] ["case" "op" [":state/connect" ["state/connect" "db" "op-data" "state-id" "op-id" "op-time"]] [":state/disconnect" ["state/disconnect" "db" "op-data" "state-id" "op-id" "op-time"]] [":state/buffer" ["state/buffer" "db" "op-data" "state-id" "op-id" "op-time"]] [":state/settings" ["state/settings" "db" "op-data" "state-id" "op-id" "op-time"]] [":state/nickname" ["state/nickname" "db" "op-data" "state-id" "op-id" "op-time"]] [":message/confirm" ["message/confirm" "db" "op-data" "state-id" "op-id" "op-time"]] [":message/clear" ["message/clear" "db" "op-data" "state-id" "op-id" "op-time"]] "db"]], "tiye-server.view/render-scene" ["defn" "render-scene" ["db"] "db"], "tiye-server.updater.message/confirm" ["defn" "confirm" ["db" "op-data" "state-id" "op-id" "op-time"] ["let" [["state" ["get-in" "db" ["[]" ":states" "state-id"]]] ["buffer" [":buffer" "state"]] ["buffer-time" [":buffer-time" "state"]] ["nickname" ["or" [":nickname" "state"] [":id" "state"]]]] ["->" "db" ["update-in" ["[]" ":states" "state-id"] ["fn" ["state"] ["if" ["some?" [":buffer" "state"]] ["->" "state" ["assoc" ":buffer" "nil"] ["assoc" ":buffer-time" "nil"]]]]] ["update" ":messages" ["fn" ["messages"] ["if" ["some?" "buffer"] ["assoc" "messages" "op-id" ["assoc" "schema/message" ":id" "op-id" ":time" "buffer-time" ":text" "buffer" ":nickname" "nickname"]] "messages"]]]]]], "tiye-server.main/db-ref" ["defonce" "db-ref" ["atom" "schema/database"]], "tiye-server.updater.state/disconnect" ["defn" "disconnect" ["db" "op-data" "state-id" "op-id" "op-time"] ["update" "db" ":states" ["fn" ["state"] ["dissoc" "state" "state-id"]]]], "tiye-server.updater.message/clear" ["defn" "clear" ["db" "op-data" "state-id" "op-id" "op-time"] ["assoc" "db" ":messages" ["{}"]]], "tiye-server.updater.state/nickname" ["defn" "nickname" ["db" "op-data" "state-id" "op-id" "op-time"] ["->" "db" ["update-in" ["[]" ":states" "state-id"] ["fn" ["state"] ["assoc" "state" ":nickname" "op-data"]]]]], "tiye-server.updater.state/settings" ["defn" "settings" ["db" "op-data" "state-id" "op-id" "op-time"] ["->" "db" ["update-in" ["[]" ":states" "state-id"] ["fn" ["state"] ["update" "state" ":show-settings?" "not"]]]]], "tiye-server.main/on-jsload" ["defn" "on-jsload" [] ["println" "|code updated"] ["reload-renderer!" "@db-ref" "updater" "render-scene" "render-view"]], "tiye-server.view/render-view" ["defn" "render-view" ["state-id" "db"] ["{}" [":state" ["get-in" "db" ["[]" ":states" "state-id"]]] [":messages" [":messages" "db"]] [":buffers" ["->>" [":states" "db"] ["filter" ["fn" ["entry"] ["some?" [":buffer" ["last" "entry"]]]]] ["map" ["fn" ["entry"] ["let" [["state" ["last" "entry"]]] ["[]" [":id" "state"] ["merge" "schema/message" ["{}" [":id" [":id" "state"]] [":text" [":buffer" "state"]] [":time" [":buffer-time" "state"]] [":nickname" ["let" [["nickname" [":nickname" "state"]]] ["if" ["and" ["some?" "nickname"] ["pos?" ["count" "nickname"]]] "nickname" [":id" "state"]]]] [":writing?" "true"]]]]]]] ["into" ["{}"]]]] [":statistics" ["{}" [":user-count" ["count" [":states" "db"]]]]]]], "tiye-server.updater.state/buffer" ["defn" "buffer" ["db" "op-data" "state-id" "op-id" "op-time"] ["->" "db" ["update-in" ["[]" ":states" "state-id"] ["fn" ["state"] ["if" ["nil?" [":buffer" "state"]] ["assoc" "state" ":buffer" "op-data" ":buffer-time" "op-time"] ["assoc" "state" ":buffer" "op-data"]]]]]], "tiye-server.updater.state/connect" ["defn" "connect" ["db" "op-data" "state-id" "op-id" "op-time"] ["assoc-in" "db" ["[]" ":states" "state-id"] ["merge" "schema/state" ["{}" [":id" "state-id"]]]]], "tiye-server.schema/message" ["def" "message" ["{}" [":id" "nil"] [":text" "|"] [":nickname" "|"] [":time" "nil"] [":writing?" "false"]]], "tiye-server.schema/state" ["def" "state" ["{}" [":user-id" "nil"] [":id" "nil"] [":buffer" "nil"] [":buffer-time" "nil"] [":show-settings?" "false"]]]}, :namespaces {"tiye-server.main" ["ns" "tiye-server.main" [":require" ["[]" "cljs.nodejs" ":as" "nodejs"] ["[]" "tiye-server.schema" ":as" "schema"] ["[]" "cumulo-server.core" ":refer" ["[]" "setup-server!" "reload-renderer!"]] ["[]" "tiye-server.updater.core" ":refer" ["[]" "updater"]] ["[]" "tiye-server.view" ":refer" ["[]" "render-view" "render-scene"]]]], "tiye-server.schema" ["ns" "tiye-server.schema"], "tiye-server.updater.core" ["ns" "tiye-server.updater.core" [":require" ["[]" "tiye-server.updater.state" ":as" "state"] ["[]" "tiye-server.updater.message" ":as" "message"]]], "tiye-server.updater.message" ["ns" "tiye-server.updater.message" [":require" ["[]" "tiye-server.schema" ":as" "schema"]]], "tiye-server.updater.state" ["ns" "tiye-server.updater.state" [":require" ["[]" "tiye-server.schema" ":as" "schema"]]], "tiye-server.view" ["ns" "tiye-server.view" [":require" ["[]" "tiye-server.schema" ":as" "schema"]]]}, :procedures {"tiye-server.main" [["set!" "*main-cli-fn*" "-main"]], "tiye-server.schema" [], "tiye-server.updater.core" [], "tiye-server.updater.message" [], "tiye-server.updater.state" [], "tiye-server.view" []}}